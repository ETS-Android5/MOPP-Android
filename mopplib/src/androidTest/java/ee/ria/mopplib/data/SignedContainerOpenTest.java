package ee.ria.mopplib.data;

import android.support.test.InstrumentationRegistry;

import org.junit.Rule;
import org.junit.Test;
import org.junit.rules.TemporaryFolder;
import org.junit.runner.RunWith;
import org.junit.runners.Parameterized;
import org.junit.runners.Parameterized.Parameter;
import org.junit.runners.Parameterized.Parameters;

import java.util.Arrays;

import ee.ria.mopplib.test.R;

import static ee.ria.mopplib.data.SignedContainerSubject.assertThat;

@RunWith(Parameterized.class)
public class SignedContainerOpenTest {

    @Parameters
    public static Iterable<Object[]> data() {
        return Arrays.asList(new Object[][]{{
            R.raw.container_23635_bdoc_ts_ocsp_random_nonce,
            R.raw.metadata_23635_bdoc_ts_ocsp_random_nonce,
            "bdoc"
        }, {
            R.raw.container_23101_bdoc21_transforms,
            R.raw.metadata_23101_bdoc21_transforms,
            "bdoc"
        }});
    }

    @Rule public final TemporaryFolder folder =
            new TemporaryFolder(InstrumentationRegistry.getContext().getCacheDir());

    @Parameter() public int containerRes;
    @Parameter(1) public int metadataRes;
    @Parameter(2) public String extension;

    @Test public void open() throws Exception {
        assertThat(folder.newFile("container." + extension), containerRes)
                .matchesMetadata(metadataRes);
    }
}
